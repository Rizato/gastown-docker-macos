#!/bin/bash
# Git credential helper that uses GITHUB_TOKEN environment variable.
# Only provides credentials for github.com over HTTPS.

case "$1" in
    get)
        while IFS='=' read -r key value; do
            case "$key" in
                protocol) protocol="$value" ;;
                host) host="$value" ;;
            esac
        done

        if [[ "$protocol" == "https" && "$host" == "github.com" && -n "$GITHUB_TOKEN" ]]; then
            echo "protocol=https"
            echo "host=github.com"
            echo "username=x-access-token"
            echo "password=$GITHUB_TOKEN"
        fi
        ;;
    store|erase)
        # No-op
        ;;
esac
